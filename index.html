<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | ChooseNew</title>
    <style>
      /* --- GENEL AYARLAR --- */
      body {
        background-image: url('arkaplan.png');
        background-size: cover;
        background-position: center;
        margin: 0; padding: 0; width: 100%; height: 100vh; overflow: hidden;
        font-family: 'Verdana', sans-serif;
      }
      #unity-container { width: 100%; height: 100%; position: absolute; background: transparent !important; }
      #unity-canvas { background: transparent !important; width: 100%; height: 100%; outline: none; }

      /* --- BALON ALANI --- */
      #loader-wrapper {
        position: absolute;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 10;
      }

      /* Balon */
      .balloon {
        width: 140px;
        height: 170px;
        background: radial-gradient(circle at 30% 30%, #ff7675, #d63031);
        border-radius: 50% 50% 50% 50% / 40% 40% 60% 60%;
        position: relative;
        box-shadow: 0 20px 30px rgba(0,0,0,0.2);
        transform: scale(0.1); 
        transform-origin: bottom center;
        animation: floatBalloon 3s ease-in-out infinite;
        transition: transform 0.1s linear; /* Kodla şişirmek için */
      }

      /* İp */
      .balloon::after {
        content: '';
        position: absolute; bottom: -30px; left: 50%; width: 2px; height: 60px;
        background: rgba(255,255,255,0.8); transform: translateX(-50%); z-index: -1;
      }
      /* Düğüm */
      .balloon::before {
        content: '';
        position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%);
        width: 16px; height: 12px; background: #d63031; border-radius: 50%;
      }
      /* Parlama */
      .shine {
        position: absolute; top: 15%; left: 15%; width: 25px; height: 45px;
        background: rgba(255,255,255,0.3); border-radius: 50%; transform: rotate(45deg);
      }

      /* Yüzde Yazısı */
      .loading-text {
        margin-top: 40px; color: white; font-size: 20px; font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.8); pointer-events: none;
      }

      /* --- PATLAMA PARÇACIKLARI (Javascript ile üretilecek) --- */
      .particle {
        position: absolute;
        top: 50%; left: 50%;
        width: 10px; height: 10px;
        border-radius: 50%;
        pointer-events: none;
        /* Javascript'ten gelen değişkenleri kullanacağız */
        transform: translate(-50%, -50%);
        animation: fly 0.6s ease-out forwards;
      }

      @keyframes fly {
        0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        100% { 
          /* --tx ve --ty değerleri JS ile rastgele verilecek */
          transform: translate(var(--tx), var(--ty)) scale(0) rotate(180deg); 
          opacity: 0; 
        }
      }

      @keyframes floatBalloon {
        0%, 100% { margin-top: 0px; }
        50% { margin-top: -10px; }
      }

      .hidden { display: none !important; }
      .unity-mobile #unity-canvas { width: 100%; height: 100%; }
    </style>
  </head>
  <body>
    <div id="unity-container">
      <canvas id="unity-canvas" width=960 height=600 tabindex="-1"></canvas>
      
      <div id="loader-wrapper">
        <div class="balloon" id="growing-balloon">
            <div class="shine"></div>
        </div>
        <div class="loading-text" id="loading-text">0%</div>
      </div>
    </div>

    <script>
      var buildUrl = "Builddd";
      var loaderUrl = buildUrl + "/16.loader.js";
      var config = {
        dataUrl: buildUrl + "/16.data.br",
        frameworkUrl: buildUrl + "/16.framework.js.br",
        codeUrl: buildUrl + "/16.wasm.br",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "ChooseNew",
        productVersion: "1.0",
        background: "transparent",
        webglContextAttributes: { "alpha": true },
      };

      var canvas = document.querySelector("#unity-canvas");
      var loaderWrapper = document.querySelector("#loader-wrapper");
      var balloon = document.querySelector("#growing-balloon");
      var loadingText = document.querySelector("#loading-text");

      // --- AKILLI YÜKLEME DEĞİŞKENLERİ ---
      var visualProgress = 0;
      var targetProgress = 0;
      var isGameLoaded = false;

      if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        var meta = document.createElement('meta');
        meta.name = 'viewport';
        meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
        document.getElementsByTagName('head')[0].appendChild(meta);
        document.querySelector("#unity-container").className = "unity-mobile";
        canvas.className = "unity-mobile";
      } else {
        canvas.style.width = "960px";
        canvas.style.height = "600px";
      }

      // --- SMOOTH LOADER & PATLAMA ---
      function updateLoader() {
        if (visualProgress < targetProgress) {
            var step = 0.01; 
            if (visualProgress > 0.8) step = 0.005; // Sonlarda yavaşla
            visualProgress += step;
            if (visualProgress > targetProgress) visualProgress = targetProgress;
        }

        // Balonu Şişir
        var scaleValue = (visualProgress * 1.1) + 0.1;
        balloon.style.transform = "scale(" + scaleValue + ")";
        loadingText.innerText = Math.round(visualProgress * 100) + "%";

        // %100 ve Hazırsa -> PATLAT
        if (visualProgress >= 1 && isGameLoaded) {
            triggerConfettiExplosion();
            return;
        }
        requestAnimationFrame(updateLoader);
      }

      function triggerConfettiExplosion() {
        // 1. Balonu ve yazıyı anında gizle
        balloon.style.opacity = "0";
        loadingText.style.opacity = "0";

        // 2. Parçacıkları oluştur (30 tane parça)
        var particleCount = 30;
        
        for (var i = 0; i < particleCount; i++) {
            createParticle();
        }

        // 3. Animasyon bitince loader'ı tamamen kaldır (0.6s sonra)
        setTimeout(function() {
            loaderWrapper.classList.add("hidden");
        }, 600);
      }

      function createParticle() {
        var p = document.createElement("div");
        p.classList.add("particle");
        
        // Rastgele Renkler (Balon kırmızısı ve tonları)
        var colors = ["#d63031", "#ff7675", "#fab1a0", "#ffffff"];
        p.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        
        // Rastgele Boyutlar
        var size = Math.random() * 8 + 4 + "px"; // 4px ile 12px arası
        p.style.width = size;
        p.style.height = size;
        
        // Rastgele Yön Hesaplama (Trigonometri)
        // 0 ile 360 derece arası rastgele açı
        var angle = Math.random() * Math.PI * 2; 
        // Merkezden ne kadar uzağa gidecek (Patlama şiddeti)
        var velocity = 100 + Math.random() * 150; 

        var tx = Math.cos(angle) * velocity + "px";
        var ty = Math.sin(angle) * velocity + "px";

        // CSS değişkenlerine ata
        p.style.setProperty("--tx", tx);
        p.style.setProperty("--ty", ty);

        loaderWrapper.appendChild(p);
      }

      requestAnimationFrame(updateLoader);

      var script = document.createElement("script");
      script.src = loaderUrl;
      script.onload = () => {
        createUnityInstance(canvas, config, (progress) => {
          targetProgress = progress;
        }).then((unityInstance) => {
          targetProgress = 1;
          isGameLoaded = true;
        }).catch((message) => {
          alert(message);
        });
      };
      document.body.appendChild(script);
    </script>
  </body>
</html>
